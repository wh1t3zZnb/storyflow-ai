# 开发日志

本文记录从项目初始化到当前迭代的所有主要改动与决策，按时间顺序整理，包含功能实现、界面调整、流程变更与文件位置。

## 时间线与操作项

- 阶段1：调研与流程选择（角色生成流程）
  - 评估两种角色工作流：
    - 直接按剧本拆出角色并生成图片
    - 先生成详细角色设定，再手动生成图片或上传
  - 结论：优先采用“详细设定 + 手动生成/上传”的工作流，便于精准控制视觉一致性。

- 阶段2：跑通最简流程（不接真数据）
  - 在角色页提供角色设定弹窗与上传/生成占位图能力。
  - 初版预览基于角色头像显示。

- 阶段3：修正预览类型与顺序
  - 预览图改为镜头级预览（而非角色预览），并调整分镜表格列顺序：先场次编号、再预览、再内容描述。
  - 位置参考：`src/components/StoryboardPane.jsx:21-33`。

- 阶段4：移除 AI 写作助手模块，增加随机模板与上传说明
  - 移除左侧 AI 交互区域；剧本页改为手动输入 + 随机生成模板 + 上传说明。
  - 位置参考：`src/components/ScriptPane.jsx:21-29`。

- 阶段5：剧本默认空输入与模板升级
  - 将默认输入设为“空”，新增 5 篇长模板（500–1500字），类型与格式多样。
  - 文件：`src/data/templates.js`。

- 阶段6：模块化拆分
  - 拆分 `App.jsx` 为多个组件：
    - `src/components/ScriptPane.jsx`（剧本编辑）
    - `src/components/CharacterPane.jsx`（角色列表与编辑入口）
    - `src/components/StoryboardPane.jsx`（分镜展示与操作）
    - `src/components/EditableCell.jsx`（表格内联编辑）
    - `src/components/AIEditPopup.jsx`（AI修改弹窗，后续可用）
  - 预览占位工具：`src/utils/mockImage.js`。

- 阶段7：导出位置与功能
  - 全局导航移除保存/导出；仅分镜页保留“导出”（JSON）按钮。
  - 位置参考：`src/components/StoryboardPane.jsx:12-19`。

- 阶段8：分镜的角色列与预览绑定
  - 在分镜表格新增“角色”列（位于“台词/音效”之后），支持多角色逗号分隔编辑。
  - 列表与卡片预览图改为显示分镜主角色（取第一个名称）对应的 `imageUrl`；无图时显示占位文案。
  - 位置参考：`src/components/StoryboardPane.jsx:26-33, 39-51, 79-92`。

- 阶段9：项目设置弹窗（比例/风格）与分步流程
  - 点击“智能拆分分镜”先弹出设置弹窗，必须选择“视频比例”和“整体风格”。
  - 确认后先从剧本提取主要角色并生成到角色页，用户检查后再点击“下一步：拆分分镜”。
  - 位置参考：
    - 弹窗：`src/components/ProjectSetupModal.jsx:1-63`
    - 弹窗触发：`src/App.jsx:647-649`
    - 角色提取与生成：`src/App.jsx:539-564`
    - 正式拆分与跳转：`src/App.jsx:530-534`

- 阶段10：按钮灰态与导航禁用态
  - “智能拆分分镜”在剧本为空时禁用且灰态样式（`.btn-disabled`）。
  - 角色页“下一步：拆分分镜”在无角色时禁用且灰态样式。
  - 导航标签根据步骤状态限制点击：`角色`在未完成设置前禁用；`分镜`仅在完成拆分后可点。
  - 位置参考：
    - 样式：`src/index.css:66-73, 167-171`
    - 脚本按钮：`src/components/ScriptPane.jsx:21-27`
    - 角色按钮：`src/components/CharacterPane.jsx:6-16`
    - 导航禁用：`src/App.jsx:615-633`

- 阶段11：分镜页一键生成预览图
  - 工具栏新增“一键生成全部预览图”，按分镜角色批量生成；无角色图则生成占位图。
  - 位置参考：`src/components/StoryboardPane.jsx:15-17`、`src/App.jsx:566-573`。

- 阶段12：移除 ESLint（避免无配置报错与噪音）
  - 删除 `package.json` 中 `lint` 脚本以及所有 ESLint 相关依赖（`eslint`、`@eslint/js`、`eslint-plugin-react*`、`globals`）。
  - 原因：终端出现 “ESLint couldn't find an eslint.config.js” 的提示；用户明确表示不需要 ESLint。
  - 位置参考：`package.json:6-13, 18-32`。

## 当前流程（状态机）

- `workflowStep` 状态：`script` → `setup` → `roles` → `frames`
- 行为与导航：
  - 脚本页点击“智能拆分分镜”→ 打开设置弹窗（`setup`）
  - 设置确认→ 角色自动生成并跳至角色页（`roles`）
  - 角色页点击“下一步：拆分分镜”→ 拆分并进入分镜页（`frames`）
  - 导航限制：`角色`在 `script` 阶段禁用；`分镜`仅在 `frames` 阶段可点。

## 主要文件索引

- 组件
  - `src/components/ScriptPane.jsx`：剧本编辑与操作（随机生成、智能拆分按钮灰态控制）
  - `src/components/ProjectSetupModal.jsx`：项目设置弹窗（比例、风格）
  - `src/components/CharacterPane.jsx`：角色列表与“下一步：拆分分镜”
  - `src/components/StoryboardPane.jsx`：分镜展示、预览图（按角色）、导出与一键生成
  - `src/components/EditableCell.jsx`：表格内联编辑单元
  - `src/components/AIEditPopup.jsx`：AI修改弹窗（可选）
- 数据与工具
  - `src/data/templates.js`：五个长剧本模板（500–1500字）
  - `src/utils/mockImage.js`：SVG占位图生成
- 样式
  - `src/index.css`：按钮灰态、导航禁用态、页面基础风格

## 说明

- 当前未接入真实模型接口；角色提取为基于对话文本的简单规则，后续可替换为真实LLM提取。
- “预览图”映射为分镜主角色的图片；若需要支持多角色融合预览，可在分镜卡片加入合成策略或选择顺序。