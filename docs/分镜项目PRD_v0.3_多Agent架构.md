# 产品需求文档 (PRD)

## 1. 文档说明

### 1.1 文档信息
| 项目名称 | Storyboard AI (分镜项目) |
| :--- | :--- |
| 文档状态 | **正式版** |
| 版本号 | v0.3 |
| 密级 | 内部公开 |

### 1.2 修改记录
| 日期 | 版本 | 修改人 | 修改描述 |
| :--- | :--- | :--- | :--- |
| 2025-12-01 | v0.1 | AI Assistant | 初稿 |
| 2025-12-01 | v0.2 | AI Assistant | 修正现状（移除剧本生成，确认图片/导出功能） |
| 2025-12-01 | v0.3 | AI Assistant | **架构重构**：确立多 Agent 协同工作流架构 |

### 1.3 术语表
| 术语 | 说明 |
| :--- | :--- |
| **Agent** | 智能体，指代系统中负责特定任务的 AI 模块（如剧本 Agent、分镜 Agent）。 |
| **The Studio** | 核心编辑器，即用户操作的主界面，用于整合所有 Agent 的产出。 |
| **Sequence** | 镜头序列，指分镜表中的一组连续镜头。 |
| **Prompt** | 提示词，用于驱动 AI 模型生成内容（文本或图片）的指令。 |

---

## 2. 产品概述

### 2.1 项目背景
在视频创作流程中，从“剧本”到“可视化分镜”再到“动态预览”的转化是核心痛点。传统流程依赖人工拆解，效率低下且难以快速迭代。本项目旨在通过 AI 技术，构建一个虚拟制作团队，将这一繁琐过程自动化。

### 2.2 产品目标
打造一个 **“AI 驱动的全流程视频创作工作台”**。
不仅仅是分镜工具，而是一个由多个专业 AI Agent（智能体）组成的虚拟制作团队。用户作为“总导演”，通过统一的编辑器指挥各个 Agent 协同工作，完成从灵感到成片的完整创作流程。

### 2.3 核心流程图
系统被划分为五个独立的专业 Agent，最终在一个核心编辑器中汇聚：

```mermaid
graph TD
    User[用户/总导演] --> Editor[核心编辑器 (The Studio)]
    
    subgraph Agents [虚拟制作团队]
        ScriptAgent[剧本 Agent]
        CharAgent[角色 Agent]
        StoryAgent[分镜 Agent]
        VideoAgent[配音 Agent]
        VoiceAgent[视频 Agent]
    end
    
    Editor <--> ScriptAgent
    Editor <--> CharAgent
    Editor <--> StoryAgent
    Editor <--> VideoAgent
    Editor <--> VoiceAgent
    
    ScriptAgent -->|剧本/大纲| StoryAgent
    CharAgent -->|角色资产| StoryAgent
    CharAgent -->|角色资产| VideoAgent
    StoryAgent -->|分镜画面| VideoAgent
    ScriptAgent -->|台词| VoiceAgent
```

---

## 3. 详细功能需求 (Agent 详解)

本系统由五个核心 Agent 组成，每个 Agent 负责特定的业务环节。

### 3.1 剧本 Agent (Scriptwriter)
*   **功能定义**：负责创意构思与文本撰写。
*   **输入**：创意梗概、题材风格、参考文本。
*   **核心功能**：
    1.  **创意扩写**：根据用户的一句话梗概，扩写成完整故事大纲。
    2.  **剧本生成**：生成标准格式的剧本（包含场景头、角色、对话、动作）。
    3.  **格式清洗**：将用户粘贴的非标准文本清洗为系统可识别的标准剧本格式。
*   **输出**：标准化的剧本文本。

### 3.2 角色 Agent (Character Designer)
*   **功能定义**：负责美术设定与一致性管理。
*   **输入**：剧本内容、角色描述。
*   **核心功能**：
    1.  **角色提取**：从剧本中自动分析并提取登场角色。
    2.  **形象设计**：生成角色的外貌描述、性格标签。
    3.  **定妆照生成**：产出标准的三视图或定妆照。
    4.  **一致性控制**：维护 FaceID 或 LoRA 权重，确保后续分镜和视频中的人物形象统一。
*   **输出**：角色卡片（含头像、设定图、Style Prompt）。

### 3.3 分镜 Agent (Storyboard Director)
*   **功能定义**：负责视听语言转化（导演视角）。
*   **输入**：剧本文本、角色设定。
*   **核心功能**：
    1.  **智能拆解**：将文本拆解为镜头序列。
    2.  **参数规划**：自动决定每个镜头的 **景别** (Shot)、**运镜** (Movement)、**角度** (Angle)。
    3.  **画面描述**：将剧情翻译为绘画 Prompt，包含构图、光影、氛围指令。
    4.  **静态预览**：调用 Text-to-Image 模型生成分镜静态图。
*   **输出**：结构化分镜表 (Sequence)。

### 3.4 视频 Agent (Video Cinematographer)
*   **功能定义**：负责动态画面生成。
*   **输入**：分镜静态图、运镜参数。
*   **核心功能**：
    1.  **图生视频 (I2V)**：基于分镜 Agent 生成的静态图，添加动态效果（如让人物眨眼、走路，让镜头推拉）。
    2.  **文生视频 (T2V)**：直接从画面描述生成视频片段（作为补充）。
    3.  **运镜控制**：严格执行分镜表中的运镜指令（Pan, Zoom, Tilt）。
*   **输出**：MP4 视频片段。

### 3.5 配音 Agent (Voice Actor)
*   **功能定义**：负责声音表演与音效。
*   **输入**：台词文本、情绪标签。
*   **核心功能**：
    1.  **角色配音 (TTS)**：根据角色性别、性格选择合适的声线进行台词朗读。
    2.  **情感控制**：识别剧本中的情绪标记（[愤怒]、[悲伤]），调整语调。
    3.  **音效/BGM**：生成环境音（下雨声、街道嘈杂声）和背景音乐。
*   **输出**：Audio 音频文件。

---

## 4. 核心编辑器 (The Studio) 需求

编辑器是所有 Agent 的“指挥中心”和“组装车间”。

### 4.1 工作流集成
*   **线性引导**：提供向导模式，引导用户按 `剧本 -> 角色 -> 分镜 -> 视频/配音` 的顺序操作。
*   **自由编辑**：用户可以随时修改任何一个 Agent 的产出（如手动修改台词、重绘某张分镜图），并要求下游 Agent 重新生成。

### 4.2 视图需求
*   **列表视图 (List View)**：Excel 风格，适合批量修改文本和参数。
*   **卡片视图 (Card View)**：侧重画面预览，适合导演审阅。
*   **时间轴视图 (Timeline View)** (规划中)：类似剪辑软件，用于预览音画同步效果。

### 4.3 交付与导出
*   **静态交付**：PDF 分镜本、Excel 拍摄计划表。
*   **动态交付**：动态分镜视频 (Animatic)，将所有分镜图/视频片段 + 配音按时间轴拼接成一个粗剪视频。

---

## 5. 差距分析与实施路线

### 5.1 当前差距 (Codebase v0.2 vs PRD v0.3)
| 模块/Agent | 当前状态 | 差距/待办 |
| :--- | :--- | :--- |
| **剧本 Agent** | 仅有编辑器 | 需重新接入 LLM 文本生成接口 |
| **角色 Agent** | 基础列表与生图 | 需优化 Prompt 策略以保持多图一致性 |
| **分镜 Agent** | 拆解+生图已实现 | 需优化构图 Prompt，支持参考图控制 |
| **视频 Agent** | **未开始** | 需接入 Runway/Kling/Luma 等 API |
| **配音 Agent** | **未开始** | 需接入 11Labs/EdgeTTS/OpenAI Audio API |

### 5.2 实施路线 (Roadmap)
1.  **Phase 1 (Current)**: 完善 **分镜 Agent** 与 **角色 Agent** 的联动，确保静态分镜的质量和导出功能。
2.  **Phase 2**: 接入 **视频 Agent**，在分镜卡片中增加“生成动态预览”按钮。
3.  **Phase 3**: 接入 **配音 Agent**，为每个分镜卡片生成音频。
4.  **Phase 4**: 重构编辑器，引入“时间轴视图”，实现粗剪预览。

---

## 6. 非功能需求 (NFR)

1.  **响应速度**：Agent 交互需有明确的 Loading 状态；长耗时任务（如视频生成）需支持后台处理或分批处理。
2.  **数据隐私**：API Key 等敏感信息仅存储在本地浏览器 (Local Storage)，不上传至服务器。
3.  **兼容性**：优先适配 Chrome/Edge 等现代浏览器桌面端。
